# üí≥ –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Loyalty App

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –ø–ª–∞—Ç–µ–∂–µ–π –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Loyalty App.

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–£—Ä–æ–≤–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤](#—É—Ä–æ–≤–Ω–∏-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)
3. [API endpoints](#api-endpoints)
4. [–ü–æ—Ç–æ–∫–∏ —Ä–∞–±–æ—Ç—ã](#–ø–æ—Ç–æ–∫–∏-—Ä–∞–±–æ—Ç—ã)
5. [–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö](#–º–æ–¥–µ–ª–∏-–¥–∞–Ω–Ω—ã—Ö)
6. [–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ](#—Ç–µ—Å—Ç–æ–≤—ã–µ-–¥–∞–Ω–Ω—ã–µ)
7. [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    React Native Frontend                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ PaymentContext (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞–º–∏)                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - topUpCard()        - –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - payBookingFromCard() - –æ–ø–ª–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - getCardBalance()   - –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å               ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì HTTP
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Express.js Backend                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ         Payment System API Endpoints                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - POST   /api/card/topup                             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - GET    /api/card/balance/:userId                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - POST   /api/bookings/:id/pay-from-card             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - GET    /api/admin/finances/summary                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - POST   /api/admin/finances/withdrawal              ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì ORM
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PostgreSQL Database                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ –¢–∞–±–ª–∏—Ü—ã:                                             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - loyalty_cards          (–±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - card_topups            (–ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞—Ä—Ç)           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - payments               (–ø–ª–∞—Ç–µ–∂–∏)                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - admin_wallets          (–∫–æ—à–µ–ª—å–∫–∏ –∞–¥–º–∏–Ω–æ–≤)          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - admin_transactions     (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∞–¥–º–∏–Ω–æ–≤)        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - withdrawal_requests    (–∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –≤—ã–≤–æ–¥)          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - transactions           (–∏—Å—Ç–æ—Ä–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –£—Ä–æ–≤–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É—Ä–æ–≤–Ω—è 1 (–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —É–ø—Ä–∞–≤–ª—è—é—â–∏–π)

**adminLevel: 1**

- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ–ø–µ—Ä–∞—Ü–∏—è–º
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–¥–∫–∏ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞ –∫–æ—à–µ–ª—å–∫–∞
- –î–æ—Å—Ç—É–ø –∫ AdminFinanceDashboard

**–ú–∞—Ä—à—Ä—É—Ç:** POST /auth/register —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `adminLevel: 1`

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É—Ä–æ–≤–Ω—è 2 (–û–±—ã—á–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)

**adminLevel: 2**

- –ë–ï–ó –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ–ø–µ—Ä–∞—Ü–∏—è–º
- –î–æ—Å—Ç—É–ø –∫ –¥—Ä—É–≥–∏–º —Ñ—É–Ω–∫—Ü–∏—è–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏

**–ú–∞—Ä—à—Ä—É—Ç:** POST /auth/register —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `adminLevel: 2`

### –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

**role: 'user', adminLevel: null**

- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–≤–æ–µ–π –∫–∞—Ä—Ç—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
- –û–ø–ª–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Å –∫–∞—Ä—Ç—ã
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π

---

## API Endpoints

### –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã (Card Top-Up)

#### POST /api/card/topup

–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Request:**
```json
{
  "userId": "user_123",
  "amount": 5000,
  "paymentMethod": "card"
}
```

**Response:**
```json
{
  "success": true,
  "message": "–ë–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω",
  "topup": {
    "id": 1,
    "userId": "user_123",
    "amount": "5000.00",
    "paymentMethod": "card",
    "status": "completed",
    "transactionId": "TOPUP_1234567890_abc123",
    "createdAt": "2026-01-11T10:30:00.000Z"
  },
  "newBalance": 5000,
  "transactionId": "TOPUP_1234567890_abc123"
}
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã:**
- `card` - –∫—Ä–µ–¥–∏—Ç–Ω–∞—è/–¥–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞
- `paypal` - PayPal
- `bank_transfer` - –±–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥
- `crypto` - –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞

---

#### GET /api/card/balance/:userId

–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏.

**Response:**
```json
{
  "success": true,
  "balance": 5000,
  "totalSpent": 2000,
  "totalEarned": 500,
  "membershipLevel": "Silver",
  "cashbackRate": 5
}
```

---

#### GET /api/card/transactions/:userId

–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `limit` (optional) - –º–∞–∫—Å–∏–º—É–º –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)
- `offset` (optional) - —Å–º–µ—â–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)

**Response:**
```json
{
  "success": true,
  "transactions": [
    {
      "id": 1,
      "userId": "user_123",
      "bookingId": 5,
      "type": "debit",
      "amount": "2500.00",
      "description": "–û–ø–ª–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è #5 —Å –∫–∞—Ä—Ç—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏",
      "balanceBefore": "7500.00",
      "balanceAfter": "5000.00",
      "createdAt": "2026-01-11T10:00:00.000Z"
    }
  ],
  "total": 15,
  "limit": 50,
  "offset": 0
}
```

---

#### GET /api/card/topups/:userId

–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π –∫–∞—Ä—Ç—ã.

**Response:**
```json
{
  "success": true,
  "topups": [
    {
      "id": 1,
      "userId": "user_123",
      "amount": "5000.00",
      "paymentMethod": "card",
      "status": "completed",
      "transactionId": "TOPUP_1234567890_abc123",
      "description": "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã —á–µ—Ä–µ–∑ card",
      "createdAt": "2026-01-11T10:30:00.000Z"
    }
  ],
  "total": 3,
  "limit": 20,
  "offset": 0
}
```

---

### –û–ø–ª–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (Booking Payments)

#### POST /api/bookings/:bookingId/pay-from-card

–û–ø–ª–∞—Ç–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–∞—Ä—Ç—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏.

**Request:**
```json
{
  "userId": "user_123"
}
```

**Response:**
```json
{
  "success": true,
  "message": "–ü–ª–∞—Ç—ë–∂ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω",
  "payment": {
    "id": 10,
    "userId": "user_123",
    "bookingId": 5,
    "amount": "2500.00",
    "currency": "RUB",
    "status": "completed",
    "paymentMethod": "loyalty_card",
    "createdAt": "2026-01-11T10:00:00.000Z"
  },
  "booking": {
    "id": 5,
    "status": "confirmed"
  },
  "newBalance": 5000,
  "paymentId": 10
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `404` - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
- `400` - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –∫–∞—Ä—Ç–µ
- `403` - –ø–æ–ø—ã—Ç–∫–∞ –æ–ø–ª–∞—Ç–∏—Ç—å —á—É–∂–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

---

#### GET /api/bookings/:bookingId/payment-status

–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –ø–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é.

**Response:**
```json
{
  "success": true,
  "bookingId": 5,
  "bookingStatus": "confirmed",
  "payment": {
    "id": 10,
    "amount": "2500.00",
    "status": "completed",
    "paymentMethod": "loyalty_card"
  },
  "isPaid": true
}
```

---

### –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (Admin Finance)

#### GET /api/admin/finances/summary

–ü–æ–ª—É—á–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Å–≤–æ–¥–∫—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `userId` (required) - ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**Response:**
```json
{
  "success": true,
  "admin": {
    "userId": "admin-user",
    "email": "admin@example.com",
    "displayName": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
    "adminLevel": 1
  },
  "wallet": {
    "totalBalance": 250000,
    "availableBalance": 250000,
    "pendingBalance": 0,
    "totalReceived": 500000,
    "totalWithdrawn": 250000
  },
  "statistics": {
    "totalPayments": 45,
    "totalAmount": 500000,
    "todayPayments": 5,
    "todayAmount": 25000,
    "averagePayment": "11111.11"
  }
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞:**
- –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å `role: 'admin'` –∏ `adminLevel: 1`

---

#### GET /api/admin/finances/transactions

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `userId` (required) - ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `limit` (optional) - –º–∞–∫—Å–∏–º—É–º –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100)
- `offset` (optional) - —Å–º–µ—â–µ–Ω–∏–µ

**Response:**
```json
{
  "success": true,
  "transactions": [
    {
      "id": 1,
      "adminId": "admin-user",
      "adminLevel": 1,
      "type": "booking_payment",
      "amount": "2500.00",
      "bookingId": 5,
      "description": "–ü–ª–∞—Ç—ë–∂ –∑–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ #5 (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: user_123)",
      "balanceBefore": "247500.00",
      "balanceAfter": "250000.00",
      "createdAt": "2026-01-11T10:00:00.000Z"
    }
  ],
  "total": 150,
  "limit": 100,
  "offset": 0
}
```

**–¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**
- `booking_payment` - –ø–ª–∞—Ç–µ–∂ –∑–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `topup_commission` - –∫–æ–º–∏—Å—Å–∏—è –æ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
- `withdrawal` - –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
- `refund` - –≤–æ–∑–≤—Ä–∞—Ç
- `adjustment` - –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞

---

#### POST /api/admin/finances/withdrawal

–°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤.

**Request:**
```json
{
  "userId": "admin-user",
  "amount": 50000,
  "bankAccount": "40817810123456789012",
  "reason": "–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥"
}
```

**Response:**
```json
{
  "success": true,
  "message": "–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–∑–¥–∞–Ω",
  "withdrawalRequest": {
    "id": 1,
    "adminId": "admin-user",
    "adminLevel": 1,
    "amount": "50000.00",
    "bankAccount": "40817810123456789012",
    "status": "pending",
    "reason": "–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥",
    "createdAt": "2026-01-11T11:00:00.000Z"
  },
  "updatedWallet": {
    "availableBalance": 200000,
    "pendingBalance": 50000
  }
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `403` - –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω (–Ω–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
- `400` - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤

---

#### GET /api/admin/finances/withdrawals

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤—ã–≤–æ–¥.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `userId` (required) - ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `status` (optional) - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É (pending, approved, completed, rejected)
- `limit` (optional) - –º–∞–∫—Å–∏–º—É–º –∑–∞–ø–∏—Å–µ–π
- `offset` (optional) - —Å–º–µ—â–µ–Ω–∏–µ

**Response:**
```json
{
  "success": true,
  "withdrawals": [
    {
      "id": 1,
      "adminId": "admin-user",
      "adminLevel": 1,
      "amount": "50000.00",
      "bankAccount": "40817810123456789012",
      "status": "pending",
      "reason": "–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥",
      "createdAt": "2026-01-11T11:00:00.000Z"
    }
  ],
  "total": 5,
  "limit": 50,
  "offset": 0
}
```

---

## –ü–æ—Ç–æ–∫–∏ —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    ‚Üì
–û—Ç–∫—Ä—ã–≤–∞–µ—Ç CardTopUpScreen
    ‚Üì
–í–≤–æ–¥–∏—Ç —Å—É–º–º—É –∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã
    ‚Üì
POST /api/card/topup
    ‚Üì
–°–µ—Ä–≤–µ—Ä:
  1. –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å CardTopUp —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'pending'
  2. –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ 'completed' (–¥–µ–º–æ)
  3. –û–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å LoyaltyCard
  4. –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å Transaction
    ‚Üì
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–ø–ª–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∫–∞—Ä—Ç—ã

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ CheckoutScreen
    ‚Üì
–í—ã–±–∏—Ä–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å —Å –∫–∞—Ä—Ç—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏"
    ‚Üì
POST /api/bookings/{id}/pay-from-card
    ‚Üì
–°–µ—Ä–≤–µ—Ä:
  1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã
  2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —ç—Ç–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  3. –°–æ–∑–¥–∞–µ—Ç Payment —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'completed'
  4. –°–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å LoyaltyCard
  5. –°–æ–∑–¥–∞–µ—Ç Transaction –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  6. –û–±–Ω–æ–≤–ª—è–µ—Ç AdminWallet —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  7. –°–æ–∑–¥–∞–µ—Ç AdminTransaction –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  8. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å Booking –Ω–∞ 'confirmed'
  9. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    ‚Üì
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
    ‚Üì
–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, –¥–µ–Ω—å–≥–∏ –ø–æ–ª—É—á–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Ñ–∏–Ω–∞–Ω—Å—ã

```
–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
    ‚Üì
–û—Ç–∫—Ä—ã–≤–∞–µ—Ç AdminFinanceDashboard
    ‚Üì
GET /api/admin/finances/summary
    ‚Üì
–°–µ—Ä–≤–µ—Ä:
  1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç adminLevel (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 1)
  2. –ü–æ–ª—É—á–∞–µ—Ç AdminWallet –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  3. –í—ã—á–∏—Å–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–ª–∞—Ç–µ–∂–µ–π
    ‚Üì
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–æ–¥–∫—É —Ñ–∏–Ω–∞–Ω—Å–æ–≤
    ‚Üì
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç:
  - –û–±—â–∏–π –±–∞–ª–∞–Ω—Å
  - –î–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å
  - –ò—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  - –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –≤—ã–≤–æ–¥
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤

```
–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞ AdminFinanceDashboard
    ‚Üì
–ù–∞–∂–∏–º–∞–µ—Ç "–í—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞"
    ‚Üì
–í–≤–æ–¥–∏—Ç —Å—É–º–º—É –∏ –Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞
    ‚Üì
POST /api/admin/finances/withdrawal
    ‚Üì
–°–µ—Ä–≤–µ—Ä:
  1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å
  2. –°–æ–∑–¥–∞–µ—Ç WithdrawalRequest —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'pending'
  3. –ü–µ—Ä–µ–≤–æ–¥–∏—Ç —Å—É–º–º—É –≤ pendingBalance
    ‚Üì
–ó–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω, –∂–¥–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è
```

---

## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### LoyaltyCard (–ö–∞—Ä—Ç–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏)

```javascript
{
  id: Integer,
  userId: String (unique),
  balance: Decimal(12,2),           // —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –≤ —Ä—É–±–ª—è—Ö
  cashbackRate: Decimal(5,2),       // –ø—Ä–æ—Ü–µ–Ω—Ç –∫—ç—à–±–µ–∫–∞
  totalSpent: Decimal(12,2),        // –≤—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ
  totalEarned: Decimal(12,2),       // –≤—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –∫—ç—à–±–µ–∫–∞
  membershipLevel: Enum['Bronze', 'Silver', 'Gold', 'Platinum'],
  createdAt: DateTime,
  updatedAt: DateTime
}
```

### CardTopUp (–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã)

```javascript
{
  id: Integer,
  userId: String,
  amount: Decimal(10,2),
  paymentMethod: String,            // card, paypal, crypto, bank_transfer
  status: Enum['pending', 'completed', 'failed'],
  transactionId: String (unique),
  description: Text,
  createdAt: DateTime,
  updatedAt: DateTime
}
```

### Payment (–ü–ª–∞—Ç–µ–∂)

```javascript
{
  id: Integer,
  userId: String,
  bookingId: Integer,
  amount: Decimal(10,2),
  currency: String,                 // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'RUB'
  status: Enum['pending', 'completed', 'failed', 'refunded'],
  paymentMethod: String,            // loyalty_card, stripe, paypal, etc.
  stripePaymentId: String,
  stripeChargeId: String,
  createdAt: DateTime,
  updatedAt: DateTime
}
```

### AdminWallet (–ö–æ—à–µ–ª–µ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

```javascript
{
  id: Integer,
  adminId: String (unique),
  adminLevel: Integer,              // 1 –∏–ª–∏ 2
  totalBalance: Decimal(12,2),      // –≤—Å–µ–≥–æ (–¥–æ—Å—Ç—É–ø–Ω—ã–π + –æ–∂–∏–¥–∞—é—â–∏–π)
  availableBalance: Decimal(12,2),  // –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å
  pendingBalance: Decimal(12,2),    // –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–≤–æ–¥–∞
  totalReceived: Decimal(12,2),     // –≤—Å–µ–≥–æ –ø–æ–ª—É—á–µ–Ω–æ
  totalWithdrawn: Decimal(12,2),    // –≤—Å–µ–≥–æ –≤—ã–≤–µ–¥–µ–Ω–æ
  isActive: Boolean,
  createdAt: DateTime,
  updatedAt: DateTime
}
```

### AdminTransaction (–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

```javascript
{
  id: Integer,
  adminId: String,
  adminLevel: Integer,
  type: Enum['booking_payment', 'topup_commission', 'withdrawal', 'refund', 'adjustment'],
  amount: Decimal(10,2),
  bookingId: Integer,
  paymentId: Integer,
  description: Text,
  balanceBefore: Decimal(12,2),
  balanceAfter: Decimal(12,2),
  createdAt: DateTime
}
```

### WithdrawalRequest (–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥)

```javascript
{
  id: Integer,
  adminId: String,
  adminLevel: Integer,
  amount: Decimal(10,2),
  bankAccount: String,
  status: Enum['pending', 'approved', 'completed', 'rejected'],
  approvedBy: String,
  reason: Text,
  createdAt: DateTime,
  approvedAt: DateTime,
  completedAt: DateTime
}
```

### Transaction (–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

```javascript
{
  id: Integer,
  userId: String,
  bookingId: Integer,
  paymentId: Integer,
  type: Enum['debit', 'credit'],    // debit = —Å–ø–∏—Å–∞–Ω–∏–µ, credit = –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
  amount: Decimal(10,2),
  description: Text,
  balanceBefore: Decimal(12,2),
  balanceAfter: Decimal(12,2),
  createdAt: DateTime
}
```

---

## –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è:

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã:

1. **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (—É—Ä–æ–≤–µ–Ω—å 1)**
   - Email: `admin@example.com`
   - Password: `password123`
   - adminLevel: 1
   - –ú–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏

2. **–û–±—ã—á–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (—É—Ä–æ–≤–µ–Ω—å 2)**
   - Email: `admin2@example.com`
   - Password: `password123`
   - adminLevel: 2
   - –ù–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:

1. **–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤**
   - Email: `user1@example.com`
   - Password: `password123`
   - –ë–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã: 500‚ÇΩ

2. **–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞**
   - Email: `user2@example.com`
   - Password: `password123`
   - –ë–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã: 1000‚ÇΩ

---

## üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ù–∞ Frontend (React Native)

#### –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã:

```javascript
import { usePayment } from '../context/PaymentContext';

function MyComponent() {
  const { topUpCard, cardBalance, isProcessing } = usePayment();
  const { user } = useAuth();

  const handleTopUp = async () => {
    try {
      const result = await topUpCard(user.id, 5000, 'card');
      console.log('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ:', result.newBalance);
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞:', error);
    }
  };

  return (
    <TouchableOpacity onPress={handleTopUp} disabled={isProcessing}>
      <Text>–ü–æ–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ 5000‚ÇΩ</Text>
    </TouchableOpacity>
  );
}
```

#### –û–ø–ª–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:

```javascript
const { payBookingFromCard } = usePayment();

const handlePayBooking = async () => {
  try {
    const result = await payBookingFromCard(bookingId, user.id);
    console.log('–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–ª–∞—á–µ–Ω–æ:', result.newBalance);
  } catch (error) {
    Alert.alert('–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã', error.message);
  }
};
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞:

```javascript
const { getCardBalance } = usePayment();

const loadBalance = async () => {
  const data = await getCardBalance(user.id);
  console.log('–ë–∞–ª–∞–Ω—Å:', data.balance);
};
```

### –ù–∞ Backend (curl –ø—Ä–∏–º–µ—Ä—ã)

#### –ü–æ–ø–æ–ª–Ω–∏—Ç—å –∫–∞—Ä—Ç—É:

```bash
curl -X POST http://localhost:5002/api/card/topup \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "user1-id",
    "amount": 5000,
    "paymentMethod": "card"
  }'
```

#### –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å:

```bash
curl http://localhost:5002/api/card/balance/user1-id
```

#### –û–ø–ª–∞—Ç–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
curl -X POST http://localhost:5002/api/bookings/1/pay-from-card \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "user1-id"
  }'
```

#### –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

```bash
curl "http://localhost:5002/api/admin/finances/summary?userId=admin-user"
```

#### –ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥:

```bash
curl -X POST http://localhost:5002/api/admin/finances/withdrawal \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "admin-user",
    "amount": 50000,
    "bankAccount": "40817810123456789012",
    "reason": "–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥"
  }'
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (adminLevel)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

- üîí –í–Ω–µ–¥—Ä–∏—Ç—å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –Ω–∞ –≤—Å–µ—Ö endpoints
- üîí –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–ª–∞—Ç–µ–∂–µ–π (Stripe, PayPal)
- üîí –î–æ–±–∞–≤–∏—Ç—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- üîí –®–∏—Ñ—Ä–æ–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–æ–º–µ—Ä–∞ —Å—á–µ—Ç–æ–≤)
- üîí –î–æ–±–∞–≤–∏—Ç—å –∞—É–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- üîí –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å rate limiting –Ω–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö endpoints
- üîí –î–æ–±–∞–≤–∏—Ç—å PCI DSS compliance

---

## üì± –≠–∫—Ä–∞–Ω—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### CardTopUpScreen (`src/screens/CardTopUpScreen.js`)

- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—É–º–º—ã (100, 500, 1000, 5000, 10000‚ÇΩ)
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–≤–µ—Å—Ç–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é —Å—É–º–º—É
- –í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã (–∫–∞—Ä—Ç–∞, PayPal, –±–∞–Ω–∫, –∫—Ä–∏–ø—Ç–æ)
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è

### AdminFinanceDashboard (`src/screens/AdminFinanceDashboard.js`)

- –°–≤–æ–¥–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤ (–æ–±—â–∏–π –±–∞–ª–∞–Ω—Å, –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Å—É–º–º–∞, —Å—Ä–µ–¥–Ω–µ–µ)
- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤—ã–≤–æ–¥
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–î–µ–º–æ-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π** - –ø–ª–∞—Ç–µ–∂–∏ —É—Å–ø–µ—à–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
2. **–†—É—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–≤–æ–¥–æ–≤** - —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–æ–º
3. **–û–¥–Ω–∞ –≤–∞–ª—é—Ç–∞** - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ RUB
4. **–ë–µ–∑ —Ä–∞—Å—Å—Ä–æ—á–∫–∏** - –Ω–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞—Å—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ —Å–∏—Å—Ç–µ–º–µ –ø–ª–∞—Ç–µ–∂–µ–π —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ issues –≤ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 11 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
